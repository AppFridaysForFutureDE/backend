<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8"/>
  <link rel="icon" href="https://fridaysforfuture.de/wp-content/uploads/2019/04/cropped-icon-32x32.png" sizes="32x32">
  <link rel="icon" href="https://fridaysforfuture.de/wp-content/uploads/2019/04/cropped-icon-192x192.png" sizes="192x192">
  <link rel="stylesheet" href="https://indestructibletype.com/fonts/Jost.css" type="text/css" charset="utf-8" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />
  <style>
  button {
    font-family: Jost;
    font-size: 14px;
  }
  </style>

  <script>
  getFirebase();

  function getFirebase() {
    const fbStatus = new XMLHttpRequest();
    const url='/admin/controls/firebaseStatus';
    fbStatus.open("GET", url);
    fbStatus.send();
    fbStatus.onreadystatechange = (e) => {
      console.log(fbStatus.responseText);
      const state = JSON.parse(fbStatus.responseText);
      if (state.firebaseStatus == true) {
        document.getElementById("status").textContent = "Verbindung zu Firebase hergestellt";
      } else {
        document.getElementById("status").textContent = "Verbindung zu Firebase nicht hergestellt";
      }
    }
  }

  function requestBackup() {
    const backup = new XMLHttpRequest();
    const url='/admin/controls/createBackup';
    backup.open("POST", url);
    backup.send();
    backup.onreadystatechange = (e) => {
      console.log(backup.responseText);
      const state = JSON.parse(backup.responseText);
      if (state.createdBackup == true) {
        document.getElementById("backup").textContent = "Backup erstellt";
      } else if (state.createdBackup == false) {
        document.getElementById("backup").textContent = "Backup konnte nicht erstellt werden";
      }
    }
  }

  function requestPopulate() {
    const populate = new XMLHttpRequest();
    const url='/admin/controls/populateDB';
    populate.open("POST", url);
    populate.send();
    populate.onreadystatechange = (e) => {
      console.log(populate.responseText);
      const state = JSON.parse(populate.responseText);
      if (state.performedPopulate == true) {
        document.getElementById("populate").textContent = "Datenbank aktualisiert";
      } else if (state.performedPopulate == false) {
        document.getElementById("populate").textContent = "Datenbank konnte nicht aktualisiert werden";
      }
    }
  }
  </script>

  <style>
  table {
    border-collapse: collapse;
  }
  table, th, td {
    border: 1px solid black;
  }
  span {
    font-family: monospace;
  }
  </style>

  <title>
    App For Future
  </title>
<head>

<body>

  <div class="flex-container">

    <div id="image">
      <a href="/">
        <img src="../img/app.gif"/>
      </a>
    </div>

  	<div id="text">
      <h1>
    	  Control Panel
      </h1>
      <table>
        <tr>
          <th>Dienst</th>
          <th>Status</th>
          <th>Aktion</th>
        </tr>

        <tr>
          <td>
            Firebase-Status
          </td>
          <td>
            <span id="status">Nicht geladen</span>
          </td>
          <td>
            <button type="button" onclick="getFirebase()">Aktualisieren</button>
          </td>
        </tr>

        <tr>
          <td>
            Backup
          </td>
          <td>
            <span id="backup">Nicht ausgeführt</span>
          </td>
          <td>
            <button type="button" onclick="requestBackup()">Jetzt erstellen</button>
          </td>
        </tr>

        <tr>
          <td>
            Datenbank
          </td>
          <td>
            <span id="populate">Nicht ausgeführt</span>
          </td>
          <td>
            <button type="button" onclick="requestPopulate()">Jetzt Datenbank aktualisieren</button>
          </td>
        </tr>
      </table>
    </div>

  </div>

</body>

</html>
